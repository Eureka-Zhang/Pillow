# 气囊控制器 (Airbag Controller)

通过Arduino控制4个气囊的充气和放气系统，PC端通过键盘操控。

## 硬件连接

### 引脚对应关系

| 气囊 | 充气泵(Pump) | 放气阀(Valve) |
|------|--------------|---------------|
| 气囊1 | D8 | D2 |
| 气囊2 | D9 | D3 |
| 气囊3 | D10 | D4 |
| 气囊4 | D11 | D5 |

### 电平说明
- **高电平 (HIGH)**: 开启 (充气泵工作/放气阀打开)
- **低电平 (LOW)**: 关闭 (充气泵停止/放气阀关闭)

### 时间设置
- **充气**: 5秒 / 10秒 两档
- **放气**: 10秒 / 15秒 两档

## 软件安装

### 1. Arduino端

1. 打开 Arduino IDE
2. 打开 `airbag_controller/airbag_controller.ino` 文件
3. 选择正确的开发板和端口
4. 点击上传

### 2. PC端

```bash
# 安装Python依赖
cd Actuator
pip install -r requirements.txt

# 运行控制程序
python pc_controller.py

# 或指定串口
python pc_controller.py /dev/ttyUSB0    # Linux
python pc_controller.py COM3            # Windows
```

## 键盘操作

键盘布局设计为直观的矩阵形式：
- **竖列** 对应同一个气囊 (1-4)
- **横行** 对应同一种操作

```
┌──────────┬─────────┬─────────┬─────────┬─────────┐
│   操作   │  气囊1  │  气囊2  │  气囊3  │  气囊4  │
├──────────┼─────────┼─────────┼─────────┼─────────┤
│ 充气 5s  │    1    │    2    │    3    │    4    │
│ 充气10s  │    Q    │    W    │    E    │    R    │
│ 放气10s  │    A    │    S    │    D    │    F    │
│ 放气15s  │    Z    │    X    │    C    │    V    │
└──────────┴─────────┴─────────┴─────────┴─────────┘
```

### 特殊按键
- **ESC**: 紧急停止所有操作
- **H**: 显示帮助信息
- **Ctrl+C**: 退出程序

## 串口通信协议

### 命令格式
```
<命令类型><气囊编号><档位>
```

- **命令类型**: `P` (充气) 或 `V` (放气)
- **气囊编号**: `1-4`
- **档位**: `1` 或 `2`
  - 充气: 1=5秒, 2=10秒
  - 放气: 1=10秒, 2=15秒

### 示例
| 命令 | 含义 |
|------|------|
| `P11` | 气囊1充气5秒 |
| `P22` | 气囊2充气10秒 |
| `V31` | 气囊3放气10秒 |
| `V42` | 气囊4放气15秒 |
| `S00` | 停止所有操作 |

### 响应格式
- `OK:xxx` - 操作成功
- `ERR:xxx` - 操作失败

## 文件结构

```
Actuator/
├── airbag_controller/
│   └── airbag_controller.ino  # Arduino控制代码
├── pc_controller.py            # PC端Python控制程序
├── requirements.txt            # Python依赖
└── README.md                   # 本文档
```

## 注意事项

1. 每次只能执行一个操作，新命令会中断当前操作
2. 操作完成后设备自动停止
3. 遇到紧急情况请立即按 ESC 键停止
4. 确保Arduino已正确上传程序后再运行PC端程序
